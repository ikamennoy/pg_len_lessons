# Тема: Миграция сервера PostgreSQL в кластер с минимизацией времени простоя #

Цели проекта
- Резервирование данных с помощью репликации
- Автоматическое решение с failover, quorum
- Надежность и высокодоступность как бонус опции

Что планировалось
1 Анализ вариантов кластера, выбор оптимального решения – на этом этап ушло больше всего времени

2 Реализация в виде скрипта – для развертывания тестового окружения и выполнения работ на нем

3 Проведение исптытаний

4 По позможности эксперименты, самописные скрипты с возможностью оценки доступности. ApacheSupersetили свое решение

Используемые технологии
```
1. Postgres и физическая репликация + Patroni – мейнстрим
для оранизации высокодоступных кластеров.
2. Consul – функционален, быстр и надежен благодаря
протоколу Gossip фокусируется на обнаружении сервисов
и сегментации сети. Простой и понятный HTTP REST API
(простые данные, не более 20 разных API функций), либо
DNS сервисы с SRV записями, компилируется на Go в 1
бинарник
3. Haproxy – балансировка
4. Keepalived – виртуальный IP для тупых приложений – но
честно говоря достаточно и Haproxy в целом то
```

В результате   1 скрипт: развертывание машин, создание инстанса Postgresql – и на базесуществующего – создание кластераPatroni
    1 мастер, 2 реплики - в случае вывода машины - все равнозначны.

vb(haproxy,patroni+consul,postgresql) <-> va(haproxy,patroni+consul,postgresql) vd(haproxy,patroni+consul,postgresql)

Выводы и планы по развитию
```
1.Можно внедрить watchdog,
2. более глубо разобрать consul, postgres, patroni, https://github.com/kelseyhightower/confd/blob/master/docs/quick-start-guide.md or consul-template
3 .Попробовать pypgsql
4.Добавить мониторинг
5. попробовать тоже самое на K8s ... https://github.com/citusdata/citus
6. внедрить pgbouncer - несколько потоков 
7. метрики или проверки в consul
```

