scope: pgcluster
name: HOSTNAME

log:
  format: '%(asctime)s %(levelname)s: %(message)s'
  level: INFO
  max_queue_size: 1000
  traceback_level: ERROR

restapi:
  connect_address: IPADDR:8008
  listen: IPADDR:8008

consul:
  host: 127.0.0.1
  register_service: true
# If the cluster is already initialized, all changes in the `bootstrap` section are ignored!
bootstrap:
  dcs:
    loop_wait: 10
    retry_timeout: 10
    ttl: 30
    postgresql:
      parameters:
        DateStyle: ISO, DMY
        TimeZone: Europe/Moscow
        cluster_name: 'pgcluster'
        default_text_search_config: pg_catalog.russian
        dynamic_shared_memory_type: posix
        hot_standby: 'on'
        lc_messages: ru_RU.UTF-8
        lc_monetary: ru_RU.UTF-8
        lc_numeric: ru_RU.UTF-8
        lc_time: ru_RU.UTF-8
        log_destination: stderr
        log_directory: log
        log_filename: postgresql-%a.log
        log_line_prefix: '%m [%p] '
        log_rotation_age: 1d
        log_rotation_size: '0'
        log_timezone: Europe/Moscow
        log_truncate_on_rotation: 'on'
        logging_collector: 'on'
        max_connections: '100'
        max_locks_per_transaction: '64'
        max_prepared_transactions: '0'
        max_replication_slots: '10'
        max_stack_depth: 2MB
        max_wal_senders: '10'
        max_wal_size: 1GB
        max_worker_processes: '8'
        min_wal_size: 80MB
        password_encryption: scram-sha-256
        shared_buffers: 128MB
        track_commit_timestamp: 'off'
        wal_keep_size: '0'
        wal_level: replica
        wal_log_hints: 'off'
      use_slots: true

postgresql:
  authentication:
    replication:
      password: 'ReplTest123'
      username: patronr
    rewind:
      password: 'testReW1nd'
      username: rewind_user
    superuser:
      password: 'test123Rs'
      username: postgres
  bin_dir: /usr/pgsql-13/bin
  connect_address: 'HOSTNAME'
  data_dir: '/var/lib/pgsql/13/data'
  listen: '*'
  parameters:
    config_file: /var/lib/pgsql/13/data/postgresql.conf
    hba_file: /var/lib/pgsql/13/data/pg_hba.conf
    ident_file: /var/lib/pgsql/13/data/pg_ident.conf
    password_encryption: scram-sha-256
  pg_hba:
  - local   all             all                                     peer
  - host    all             all             127.0.0.1/32            scram-sha-256
  - host    all             all             ::1/128                 scram-sha-256
  - local   replication     all                                     peer
  - host    replication     all             127.0.0.1/32            scram-sha-256
  - host    replication     all             ::1/128                 scram-sha-256
  - host    replication     all     10.0.0.0/16                 scram-sha-256
  - host    all     all             10.0.0.0/16                 scram-sha-256

tags:
  clonefrom: true
  failover_priority: 1
  noloadbalance: false
  nosync: false

